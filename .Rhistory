mutate(Species_name = gsub("_", " ", Species_name),
## removing gb || sequence from species name
### uncomment if we need this line again
Species_name = str_after_nth(Species_name, "\\|", 2)
)
NCBI_taxassigned <- read.delim2(path_blast_ncbi_taxassigned, header=F, col.names = c("staxid", "Phylo")) %>%
## creating taxonomic assignment columns
separate(Phylo, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species_name"), sep = ";") %>%
## creating species column based on Species_name
mutate(., species = str_after_nth(Species_name, " ", 1))
Blast_NCBI <- read.table(path_blast_ncbi, header=F,
col.names = c("ASV_ID", "sseqid", "sscinames", "staxid", "pident", "length", "mismatch",
"gapopen", "qstart", "qend", "sstart", "send", "evalue", "bitscore"),
colClasses = c(rep("character", 3), "integer", rep("numeric", 9))) %>%
left_join(., NCBI_taxassigned, by = "staxid")
### Read in fasta file
fasta <- readDNAStringSet(path_seq_file)
## Creating db from the fasta information
fasta_db <- data.table(
ASV_ID = names(fasta),
sequence = as.character(fasta)
)
ASV_table <- read_tsv(path_asv_table, show_col_types = FALSE) %>%
## calculate the sum of all reads for each ASV
mutate(., ASV_sum = rowSums(across(where(is.numeric)))) %>%
## calculate a ranking based on those sum calculated above
mutate(ASV_rank = rank(-ASV_sum, ties.method='random')) %>%
## move the sum and rank columns to after ASV_ID and arrange by rank
relocate(c(ASV_sum,ASV_rank), .after = ASV_ID) %>% arrange((ASV_rank)) %>%
## editing the rank value to be out of the max #
mutate(ASV_rank = paste0(ASV_rank, "/", max(ASV_rank, na.rm = TRUE)))
## creating list of rankings
ASV_rank_list <- ASV_table %>% dplyr::select(ASV_ID, ASV_sum, ASV_rank)
multiple_hit_choice <- Blast_GMGI %>% dplyr::group_by(ASV_ID) %>%
## take top percent identity hit, count the number of top hits, and filter to those with more than 1 top hit
slice_max(pident, n=1) %>% dplyr::count() %>% filter(n>1) %>%
dplyr::rename(No_tied_hits=n) %>%
## adding BLAST_GMGI information with these ASVs and ASV rank and sum
left_join(., Blast_GMGI, by = "ASV_ID") %>%
left_join(., ASV_rank_list, by = "ASV_ID") %>%
## adding choice column for next steps
mutate(Choice = NA) %>%
## adding sequencing information
left_join(., fasta_db, by = "ASV_ID") %>%
## moving database percent ID to be next to Blast percent ID
relocate(c(db_percent_ID, ASV_sum, ASV_rank), .after = pident)
## export this data frame as excel sheet
multiple_hit_choice %>% write_xlsx(path_choice_required)
multiple_hit_choice_edited <- read_xlsx(path_choice_required_edited) %>%
## selecting the choices made
filter(!is.na(Choice)) %>%
## selecting only columns needed
dplyr::select(ASV_ID, sseqid, Choice)
# Create a new edited df
Blast_GMGI_edited <- Blast_GMGI
# Loop through each row of the dataframe
for (i in multiple_hit_choice_edited$ASV_ID) {
# Extract the current row (will do this for each ASV_ID in the choice df)
current_row <- multiple_hit_choice_edited %>% subset(ASV_ID==i)
# Apply filter based on the current row's condition
Blast_GMGI_edited <- Blast_GMGI_edited %>%
filter(case_when(ASV_ID == current_row$ASV_ID ~ sseqid == current_row$sseqid,
TRUE ~ TRUE))
}
### Check the below output to confirm the filtering steps above worked (if it worked, it won't be in output)
Blast_GMGI_edited %>% dplyr::group_by(ASV_ID) %>% slice_max(pident, n=1) %>% dplyr::count() %>% filter(n>1)
## Create GMGI species input
disagree_input_GMGI <- Blast_GMGI_edited %>%
dplyr::select(ASV_ID, GMGI_pident = pident, GMGI_db_ID = db_percent_ID, GMGI_Species = Species_name) %>%
group_by(ASV_ID) %>% slice_max(GMGI_pident, n = 1, with_ties = FALSE) %>% ungroup()
## Create Mitofish input
disagree_input_Mito <- Blast_Mito %>%
dplyr::select(ASV_ID, Mito_Species = Species_name) %>% distinct() %>%
dplyr::group_by(ASV_ID) %>% mutate(Mito_Species = paste0(Mito_Species, collapse = ";")) %>% distinct() %>% ungroup()
## Create NCBI input
disagree_input_NCBI <- Blast_NCBI %>%
dplyr::select(ASV_ID, NCBI_Species = Species_name) %>% distinct() %>%
group_by(ASV_ID) %>% mutate(NCBI_Species = paste0(NCBI_Species, collapse = ";")) %>% distinct() %>% ungroup()
## Combine all three dfs into disagree_df with ASV rank information
disagree_df <- disagree_input_GMGI %>%
full_join(disagree_input_Mito, by = "ASV_ID") %>%
full_join(disagree_input_NCBI, by = "ASV_ID") %>%
full_join(., ASV_rank_list, by = "ASV_ID") %>%
mutate(Choice = NA) %>%
left_join(., fasta_db, by = "ASV_ID")
## Filtering the disagree_df to only output the entries that disagree with multiple entries
filtered_disagree_df <- disagree_df %>%
## grouping by ASV (row)
rowwise() %>%
## Filtering out rows that are unassigned across all 3 db
filter(! (is.na(GMGI_Species) && is.na(Mito_Species) && is.na(NCBI_Species) )) %>%
## Filter out rows that are GMGI assigned and empty from Mito and NCBI
filter(! (!is.na(GMGI_Species) && is.na(Mito_Species) && is.na(NCBI_Species) )) %>%
## Filtering out rows that have the same information across databases (ONLY in rows with a GMGI entry)
filter(ifelse(!is.na(GMGI_Species),
n_distinct(c_across(GMGI_Species:NCBI_Species), na.rm = TRUE) > 1, TRUE))
## export this data frame as excel sheet
filtered_disagree_df %>% write_xlsx(path_disagree_list)
ASV_table_taxID <- ASV_table %>%
## 1. Top hit from GMGI's database
left_join(Blast_GMGI_edited %>%  group_by(ASV_ID) %>%
slice_max(pident, n = 1) %>%
dplyr::select(ASV_ID, Species_name),
by = join_by(ASV_ID)) %>%
## 2. Mitofish database
### join df, select ASV_ID and Species_name columns, rename Species_name to Mito, call only distinct rows
left_join(., Blast_Mito %>% dplyr::select(ASV_ID, Mito = Species_name) %>% distinct() %>%
### group by ASV_ID, and collapse all species names separated by ;, then take only distinct rows
group_by(ASV_ID) %>% mutate(Mito = paste0(Mito, collapse = ";")) %>% distinct(), by = "ASV_ID") %>%
### if GMGI annotation is NA, then replace with Mitofish
mutate(., Species_name = ifelse(is.na(Species_name), Mito, Species_name)) %>%
## 3. NCBI database; same functions as above
left_join(., Blast_NCBI %>% dplyr::select(ASV_ID, NCBI = Species_name) %>% distinct() %>%
group_by(ASV_ID) %>% mutate(NCBI = paste0(NCBI, collapse = ";")) %>% distinct(), by = "ASV_ID") %>%
mutate(., Species_name = ifelse(is.na(Species_name), NCBI, Species_name)) %>%
## 4. if Species name is STILL not filled, call it "Unassigned"
mutate(., Species_name = ifelse(is.na(Species_name), "Unassigned", Species_name)) %>%
## removing Mito spp and NCBI spp
dplyr::select(-Mito, -NCBI) %>%
## move species name to be after ASV_ID
relocate(., c(Species_name), .after = ASV_ID)
## read in edited df
taxonomic_choice <- read_xlsx(path_disagree_list_edited) %>%
## selecting only columns needed
dplyr::select(ASV_ID, Choice)
# Create a new edited df
ASV_table_taxID_edited <- ASV_table_taxID
# Loop through each row of the dataframe
for (i in taxonomic_choice$ASV_ID) {
# Extract the current row (will do this for each ASV_ID in the choice df)
current_row <- taxonomic_choice %>% subset(ASV_ID==i)
# Apply filter based on the current row's condition
ASV_table_taxID_edited <- ASV_table_taxID_edited %>%
mutate(Species_name = case_when(
ASV_ID == current_row$ASV_ID ~ current_row$Choice,
TRUE ~ Species_name))
}
## Output will be blank
ASV_table_taxID_edited %>% dplyr::select(Species_name) %>% distinct() %>%
filter(., grepl(";", Species_name)) %>% arrange(Species_name)
### add common name column to df
ASV_table_taxID_edited <- ASV_table_taxID_edited %>%
left_join(., gmgi_db %>% dplyr::select(Species_name, Common_name, Category) %>% distinct(), by = "Species_name") %>%
relocate(., c(Common_name, Category), .after = Species_name)
### print entries with no common name
ASV_table_taxID_edited %>% dplyr::select(Species_name, Common_name) %>%
filter(is.na(Common_name)) %>% distinct() %>%
mutate(Category = NA, Kingdom = NA, Phylum = NA, Class = NA, Order = NA, Family = NA, Genus = NA, species = NA) %>%
mutate(
across(everything(), ~case_when(
Species_name == "Unassigned" ~ "Unassigned",
TRUE ~ .x
))) %>%
write_xlsx(path_commonnames_add)
## read in edited df
commonNames_annotated <- read_xlsx(path_commonnames_add_edited)
# Create a new edited df
ASV_table_taxID_annotated <- ASV_table_taxID_edited
# Loop through each row of the dataframe
for (i in commonNames_annotated$Species_name) {
# Extract the current row (will do this for each ASV_ID in the choice df)
current_row <- commonNames_annotated %>% subset(Species_name==i)
# Apply filter based on the current row's condition
ASV_table_taxID_annotated <- ASV_table_taxID_annotated %>%
mutate(Common_name = case_when(
Species_name == current_row$Species_name ~ current_row$Common_name,
TRUE ~ Common_name)) %>%
mutate(Category = case_when(
Species_name == current_row$Species_name ~ current_row$Category,
TRUE ~ Category))
}
## printing list of species name without common names
## after additions to mutate function above, this output should be zero
ASV_table_taxID_annotated %>% dplyr::select(Species_name, Common_name) %>% filter(is.na(Common_name)) %>% distinct()
ASV_table_taxID_filtered_step1 <- ASV_table_taxID_annotated %>%
## telling the df we are doing the following function by rows (ASVs)
rowwise() %>%
## Filter out reads that are less than 10 in each sample per ASV
mutate(across(.cols = (7:ncol(.)),
.fns = ~ ifelse(.x<10, 0, .x))) %>% ungroup()
nrow(ASV_table_taxID_filtered_step1)
## Remove rows with zero sums across the table
ASV_table_taxID_filtered_step2 <- ASV_table_taxID_filtered_step1 %>%
# Keep only rows where the sum across columns 7:ncol(.) is greater than 0
filter(rowSums(across(7:ncol(.))) > 0)
nrow(ASV_table_taxID_filtered_step2)
ASV_table_taxID_annotated %>%
## telling the df we are doing the following function by rows (ASVs)
rowwise() %>%
## Filter out reads that are less than 10 in each sample per ASV
mutate(across(.cols = (7:ncol(.)),
.fns = ~ ifelse(.x>10, 0, .x))) %>% ungroup() %>%
write_xlsx(reads_filtered10_out)
ASV_table_taxID_filtered <- ASV_table_taxID_filtered_step2 %>%
## telling the df we are doing the following function by rows (ASVs)
rowwise() %>%
mutate(across(.cols = 7:ncol(.),
.fns = ~ ifelse((.x / sum(.x, na.rm = TRUE)) < 0.001, NA, .x)))
ASV_table_taxID_filtered_step1 %>%
## telling the df we are doing the following function by rows (ASVs)
rowwise() %>%
mutate(across(.cols = 7:ncol(.),
.fns = ~ ifelse((.x / sum(.x, na.rm = TRUE)) > 0.001, NA, .x))) %>%
write_xlsx(reads_filtered_percent_out)
### View final number of reads for each sample
colsums <- as.data.frame(colSums(ASV_table_taxID_filtered[, 7:ncol(ASV_table_taxID_filtered)], na.rm = TRUE)) %>%
dplyr::rename(sum=1) %>% arrange(sum) %>% rownames_to_column(var = "sampleID")
range(colsums$sum)
# ### Identify samples with <1000 reads
# low_read_samples <- colsums %>% filter(sum < 1000) %>% pull(sampleID)
#
# ### Remove those samples from dataset
# ASV_table_taxID_filtered <- ASV_table_taxID_filtered %>%
#   dplyr::select(-all_of(low_read_samples))
#
# ### Verify
# range(colSums(ASV_table_taxID_filtered[, 7:ncol(ASV_table_taxID_filtered)], na.rm = TRUE))
ASV_table_taxID_filtered
saveRDS(ASV_table_taxID_filtered, results_filtered_df)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Common_name:Category)) %>%
relocate(matches("BK|EC"), .after = Species_name)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
sum(grepl("BK|EC", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(48),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
library(microDecon) ## for microDecon
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(48),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
df_for_microDecon
colnames(df_for_microDecon)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Common_name:Category), -ASV_sum, -ASV_rank) %>%
relocate(matches("BK|EC"), .after = Species_name)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
sum(grepl("BK|EC", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(48),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
View(df_for_microDecon)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Common_name:Category), -ASV_sum, -ASV_rank) %>%
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = Species_name)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
sum(grepl("BK|EC", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(48),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
df_for_microDecon
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Common_name:Category), -ASV_sum, -ASV_rank, -TDL_FS_13_12S) %>%
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = Species_name)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
sum(grepl("BK|EC", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=T)
df_for_microDecon
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Common_name:Category), -ASV_sum, -ASV_rank, -Species_name) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = Species_name)
ASV_table_taxID_filtered
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = Species_name)
ASV_table_taxID_filtered
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = Species_name)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = ASV_ID)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
sum(grepl("BK|EC", colnames(df_for_microDecon)))
df_for_microDecon
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
## number of samples - 1 (still troubleshooting why this is - 1..)
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## this includes species name column for us
taxa=F)
df_for_microDecon
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=T)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = ASV_ID) %>%
column_to_rownames(var = "ASV_ID")
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=F)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = ASV_ID)
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=F)
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=T)
## Add annotation as needed for the name of the NTC or blank
df_for_microDecon <- ASV_table_taxID_filtered %>%
dplyr::select(-(Species_name:Category), -ASV_sum, -ASV_rank) %>%
## remove any samples with 0 reads total
dplyr::select(-TDL_FS_13_12S) %>%
## replace NAs with zeros
dplyr::mutate(across(where(is.numeric), ~ tidyr::replace_na(.x, 0))) %>%
relocate(matches("BK|EC"), .after = ASV_ID)
## re-formatting
df_for_microDecon <- as.data.frame(df_for_microDecon)
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=F)
## print the number of field samples in dataframe
sum(grepl("_FS", colnames(df_for_microDecon)))
decontaminated <- decon(data = df_for_microDecon,
## number of blank columns [integer]
numb.blanks=1,
## number of individuals per group [integer]
numb.ind=c(47),
## Indicate if taxa columns are present (T/F)
## no species information here
taxa=F)
### Reads removed
removed <- decontaminated$reads.removed
save(removed, file = reads_decontaminated_out)
decontamin_df <- decontaminated$decon.table
decontamin_df
ASV_table_taxID_filtered
## if multiple blanks, a new column called Mean.blank is created, if not the column name remains the same
ASV_table_taxID_decontaminated <- decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID"
)
ASV_table_taxID_decontaminated
decontamin_df
View(ASV_table_taxID_decontaminated)
## if multiple blanks, a new column called Mean.blank is created, if not the column name remains the same
ASV_table_taxID_decontaminated <- decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID") %>%
na.omit()
ASV_table_taxID_decontaminated
decontamin_df
ASV_table_taxID_decontaminated
decontamin_df
decontaminated$decon.table
removed
decontamin_df
View(decontamin_df)
decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID") %>%
dplyr::select(-matches("EC"))
decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID")
decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID") %>%
dplyr::select(-matches("_EC"))
decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID")
## if multiple blanks, a new column called Mean.blank is created, if not the column name remains the same
ASV_table_taxID_decontaminated <- decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID") %>%
dplyr::select(-matches("_EC"))
## if multiple blanks, a new column called Mean.blank is created, if not the column name remains the same
ASV_table_taxID_decontaminated <- decontamin_df %>% full_join(
ASV_table_taxID_filtered %>% dplyr::select(ASV_ID, Species_name, Common_name, Category, ASV_sum, ASV_rank), .,
by = "ASV_ID") %>%
dplyr::select(-matches("_EC")) %>%
## removing ASVs that were removed by decontamin
## these are characterized by NA read counts across every sample so remove NAs
na.omit()
ASV_table_taxID_filtered
ASV_table_taxID_collapsed %>% dplyr::group_by(Species_name, Category) %>%
reframe(Filtered_reads = sum(ASV_sum))
ASV_table_taxID_decontaminated %>% dplyr::group_by(Species_name, Category) %>%
reframe(Filtered_reads = sum(ASV_sum))
ASV_table_taxID_decontaminated %>% dplyr::group_by(Species_name, Category) %>%
reframe(Filtered_reads = sum(ASV_sum)) %>%
## arrange by stats
arrange(desc(Filtered_reads)) %>%
mutate(
Percent = round(Filtered_reads / sum(Filtered_reads) * 100, 4)
)
View(ASV_table_taxID_decontaminated)
